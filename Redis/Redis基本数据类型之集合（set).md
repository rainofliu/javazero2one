# Redis基本数据类型之集合（set)

与List（列表）类型相似，集合（set）类型也是用来保存多个的字符串元素，但和列表类型不一 样的是，集合中**不允许有重复元素**，并且**集合中的元素是无序的**，**不能通过索引下标获取元素**。

> 一个集合最多可以存储2^32-1个元 素。
>
> Redis除了支持集合内的增删改查，同时还支持**多个集合取交集、并 集、差集**，合理地使用好集合类型，能在实际开发中解决很多实际问题。
>
> 比如社交平台的关注，可以通过Redis获取到不同用户之间共同关注的大V。

## 命令

### 求多个集合的交集

> `sinter key[key...]`

例如下面代码是求user∶1∶follow和user∶2∶follow两个集合的交集，返回结果是sports、it∶
`127.0.0.1:6379>sinter user:1:follow user:2:follow` 

### 求多个集合的并集

> `suinon key [key...]`

例如下面代码是求user∶1∶follow和user∶2∶follow两个集合的并集，返回结果是sports、it、his、news、music、ent∶
`127.0.0.1:6379> sunion user:1:follow user:2:follow` 

### 求多个集合的差集

> `sdiff key [key...1`

## 内部编码

集合类型的内部编码有两种： 

1. `intset`（整数集合）：当集合中的元素都是整数且元素个数小于`set-max- intset-entries`配置（默认512个）时，Redis会选用`intset`来作为集合的内部实 现，从而**减少内存的使用**。 
2. `hashtable`（哈希表）：当集合类型无法满足`intset`的条件时，Redis会使 用`hashtable`作为集合的内部实现

## 使用场景

集合类型比较典型的使用场景是**标签（tag）**。

例如一个用户可能对娱乐、体育比较感兴趣，另一个用户可能对历史、新闻比较感兴趣，这些兴趣点就是标签。

有了这些数据就可以得到**喜欢同一个标签**的人，以及**用户的共同喜好的标签**，这些数据对于**用户体验以及增强用户黏度比较重要**。

例如一 个电子商务的网站会对不同标签的用户做不同类型的推荐，比如对数码产品 比较感兴趣的人，在各个页面或者通过邮件的形式给他们推荐最新的数码产 品，通常会为网站带来更多的利益。

> **用户和标签的关系维护应该在一个事务内执行，防止部分命令失败造成数据不一致。**

实际开发场景会使用到的命令：

> 1. sadd=Tagging（标签） 
> 2. spop/srandmember = Random item（生成随机数，比如抽奖） 
> 3. sadd+sinter = Social Graph（社交需求）
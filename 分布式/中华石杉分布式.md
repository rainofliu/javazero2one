[toc]

## 互联网大厂技术要求

### 技术广度

+ JVM

+ 数据库

+ 并发

  > Java编程语言层面的考察

+ 分布式

  + 缓存
  + 消息中间件
  + ES


### 技术深度（定位问题、解决问题）

> 你有没有读过哪些开源项目的源码，RocketMQ，RocketMQ的源码，Dubbo的源码，如果你精通一些技术的源码的话，为什么会特别的有价值，有竞争力，让面试官更加的倾向于用你呢？

**技术深度决定了你的技术功底，决定了在生产环境随时你的系统使用的各种技术可能会遇到一些异常或者报错，导致系统挂掉**

Dubbo、RocketMQ、Kafka、ES，随时可能有问题，比如说Dubbo随时可能会报错，RocketMQ突然异常了无法写入消息，ES突然性能巨慢，一次查询要十几秒的时间

必须需要那些精通一些技术源码的同学，现场根据异常去分析技术的源码，从源码级别定位到问题的所在，然后解决问题

**大厂，很可能会考察你的技术深度，如果发现你没有什么技术深度，那么可能你就没有太大的竞争优势**

### 系统设计

往简单了说，就是会考察一些问题，比如说让你来设计秒杀系统，设计一个12306火车票购票系统，支撑几亿用户买火车票，你会如何来设计，让你设计一个微信红包系统，你会如何来考虑？

### 项目经验（实践能力）

+ 平时用的技术在项目中如何结合业务来进行落地
+ 在项目的生产环境中落地一个技术后，对他怎么进行生产优化、架构优化和生产实践的

> 比如分库分表，你说你简历里用过Sharding-JDBC来做分库分表
>
> 首先给我说说，你们的系统有哪些库哪些表，对应的是哪些业务呢？然后告诉我，核心的表每天新增的数据量有多少，目前已经积累了多少数据了？单表是百万级？还是千万级？你们是什么时候分的表？什么时候分的库？为什么？
>
> 在没有分表之前，SQL的性能大概如何？分表之后SQL的性能大概如何？分库之前每个数据库服务器上放多少GB的数据？一台服务器可以抗多少数据？分库之后拆分到几台数据库服务器上去？每台服务器现在放多少GB的数据？

> 很多同学出去面试，学习了很多的技术，无论是跟着一些视频课程，在线培训课程，或者是网上的博客，或者是一些书，积累了很多的知识，Sharding-JDBC分库分表基本的原理，常见的分库分表的技术方案
>
> **但是呢，这些同学往往是为了面试去准备的一些技术，但是其实从没在自己的项目中实践过，也从没思考过这些技术在自己项目落地的各种细节应该是如何来进行设计的**
>
> 出去面试的时候，往往被 面试官一通追问项目的各种细节，然后就直接死了

**其实就是知识理论没有得到充分实践的问题，纸上谈兵是工程行业的大忌！**

### 生产经验

> 分布式、微服务这块，你说用过网关，网关调研了哪几种技术？对比一下他们的优缺点？最后你们是怎么进行**技术选型**的？你们这个系统每天的访问量多高？高峰期QPS多高？你们网关要抗多高的QPS？网关是如何部署的？部署了几台机器？每台机器的配置如何，几个核CPU，几个GB内存？

> 比如你的服务里加了一个新的接口，总不能你每次都手动在网关里配置一些新的接口和服务的对应关系，网关的动态路由是怎么做的？每次上线服务或者新的接口，跟你的网关动态路由是如何搭配起来的？
>
> 线上网关部署的机器在生产环境，你们的访问压力下，平时的高峰期的CPU负载如何
>
> 有没有考虑过网关的扩容？如果压力过大如何进行扩容？
>
> 有没有测算过网关进行请求路由的性能如何？一般一个请求经过网关层的路由对时间的开销大概是多少？
>
> 现在的话呢，假设说，网关当时在线上部署之后生产环境运行的时候有没有遇到过什么问题？比如并发的问题，性能的问题？如果要对生产环境的网关进行高并发、高性能的优化，你们是怎么做的呢？如果要做，你觉得从哪些角度入手可以去做？

+ 项目经验，技术在项目中如何落地，各种细节，如果你是一个带几个小弟的资深工程师的话，此时你就必须对你负责的这个项目进行所有细节的把控，希望你能够**结合业务和项目的细节去考虑技术如何落地**

+ 生产经验，把控项目部署后的生产环境里的情况，对各种情况做出对应的举措和优化的手段，全面为自己的项目来进行负责

### 总结

+ 跟上国内主流技术栈

  > MQ，消息丢失，消息重复，高可用部署，原理；缓存，数据库和缓存双写怎么保证一致性；分布式锁，实现原理；分布式事务的常见方案；Dubbo、Spring Cloud
  >
  > 要进行主流技术栈的自我扫盲

## Dubbo

### 基本原理

![](https://liutianruo-2019-go-go-go.oss-cn-shanghai.aliyuncs.com/images/dubbo-framework-principle.png)

**服务注册中心**：

#### 消费者

##### 动态代理：Proxy

##### 负载均衡：Cluster，负载均衡，故障转移

##### 注册中心：Registry

##### 通信协议：Protocol，filter机制，http、rmi、dubbo等协议

###### http、rmi、dubbo

比如说，我现在其实想要调用的是，DemoService里的sayHello接口

你的请求用什么样的方式来组织发送过去呢？以一个什么样的格式来发送你的请求？

http，/demoService/sayHello?name=leo rmi，另外一种样子 dubbo，另外一种样子，interface=demoService|method=sayHello|params=name:leo

###### **信息交换**：Exchange，Request和Response

对于你的协议的格式组织好的请求数据，需要进行一个封装，Request

##### 网络通信：Transport，netty、mina

##### 序列化：封装好的请求如何序列化成二进制数组，通过netty/mina发送出去

#### 提供者

##### 网络通信：Transport，基于netty/mina实现的Server

##### 信息交换：Exchange，Response

##### 通信协议：Protocol，filter机制

##### 动态代理：Proxy

#### 如何扩展

两点，第一点，是核心的组件全部接口化，组件和组件之间的调用，必须全部是依托于接口，去动态找配置的实现类，如果没有配置就用他自己默认的

第二点，提供一种自己实现的组件的配置的方式，比如说你要是自己实现了某个组件，配置一下，人家到时候运行的时候直接找你配置的那个组件即可，作为实现类，不用自己默认的组件了

### 原理总结

对**Dubbo**稍微做了一点进一步深入的讲解，但是远远是达不到精通源码的程度，只能说是相对于面试突击第一季要深入了一些，**Dubbo**一次服务请求调用，牵扯到了哪些组件，**负载均衡组件**、**注册中心**、**协议层**、**转换层**、**网络层（netty开发）**、**动态代理**，服务提供者也是类似的

网络通信的一些东西，是如何通过**NIO**的方式，**多线程**的方式，让一个服务提供者被多个服务消费者去并发的调用和请求

从整体架构原理的角度，说了一下如何进行扩展的

1. 服务调用
2. 网络通信
3. SPI机制

### 如何设计一个RPC框架

人家并不是要你手撸一个**RPC框架**，资料，现场手撸一个**RPC框架**，撸的特别的简单，人家也不是要你手撸，也不是说让你进来了以后就是让你来研发RPC框架的

**系统设计的问题，就是让你站在系统设计的角度，来考虑一下，到底如果要设计一个RPC框架，你会如何来考虑**

动态代理：比如消费者和提供者，其实都是需要一个实现某个接口的**动态代理**的，RPC框架的一切的逻辑细节，都是在这个动态代理中实现的，动态代理里面的代码逻辑就是你的RPC框架核心的逻辑

JDK提供了API，去创建针对某个接口的动态代理

调用动态代理对象的方法之后，此时就应该先干一个事情，通过Cluster层的一些组件，服务注册中心，是用什么技术来进行实现呢？往简单了说，服务注册中心也可以是你自己手撸一个，也不难

自己手撸一个，服务去注册，其他服务去拉取注册表进行发现

**ZooKeeper**，稍微自己上网百度搜索一下，**ZooKeeper**入门使用教程，基本概念和原理，还有基本的使用，了解一下

**Cluster层**，从本地缓存的服务注册表里获取到要调用的服务的机器列表

**负载均衡**，**面试突击第一季**里，我们分析过**Dubbo的负载均衡策略**，此时你就可以把那些策略说一说，我要设计多少种策略，从服务的机器列表中采用负载均衡算法从里面选择出来一台机器

选择好了机器，知道了对方的端口号，而且知道你的请求调用，调用哪个Interface的哪个方法，把这些信息交给协议层

把数据组织一下，**协议**，**序列化机制**，**底层用什么网络通信框架**，比如**netty，mina**现在用的比较少，序列化和反序列化有没有概念，**Java基础概念，一个复杂的请求数据序列化成二进制的字节数组**

**反序列化就是从字节数组变成请求数据结构**

按照那个协议的规范对请求数据进行组织，不同的协议，组织出来的数据看起来是不一样的

**netty基本的原理**

解析完毕了之后，就知道，应该调用自己本地哪个Interface的实现类的哪个方法

> 基本上就是谈谈对Dubbo设计原理的理解

### 学习目标

1. 学会Dubbo的基本原理和SPI机制
2. 能够画出Dubbo的底层架构原理图
3. 对Dubbo的源码系统掌握

### 学习资源

1. 深入理解Apache Dubbo与实战
2. Dubbo官方文档
3. Dubbo源码解析博客 